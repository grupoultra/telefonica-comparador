"use strict";var app=angular.module("comparadorApp",["ngLodash"]);app.factory("CellphonesService",["$q","$http",function(e,t){var n={};return n.cellphones={},n.selectedCellphones=[],n.getAll=function(){return t({method:"GET",url:"http://localhost:3100"}).then(function(e){n.cellphones=e.data}).catch(function(e){})},n.setSelected=function(e){n.selectedCellphones=_.filter(n.cellphones,function(t){return _.includes(e,t.id_telefono)})},n}]),app.controller("PhoneListCtrl",["$scope","lodash","CellphonesService","$location",function(e,t,n,o){e.selectedCellphones=[],e.showComparador=!1,e.$watch("hastaPrecio",function(){},!0),e.iva=.14,n.getAll().then(function(o){var s=n.cellphones;e.cellphones=s,e.cellphonesFiltered=s,e.minPrecio=parseInt((t.minBy(s,"precio").precio/1e3).toFixed(0)),e.maxPrecio=parseInt((t.maxBy(s,"precio").precio/1e3).toFixed(0)),e.desdePrecio=e.minPrecio,e.hastaPrecio=e.maxPrecio,e.minPuntos=t.minBy(s,"club_movistar").club_movistar,e.maxPuntos=t.maxBy(s,"club_movistar").club_movistar,e.desdePuntos=e.minPuntos,e.hastaPuntos=e.maxPuntos,e.destacadoChoices=0,e.selectedMarcas=[],e.marcas=t(s).sortBy("marca").groupBy("marca").keys().value(),e.selectedTecnologias=[],e.tecnologias=t(s).sortBy("tecnologia").groupBy("tecnologia").keys().value(),e.selectedAntenas=[],e.antenas=t(s).sortBy("antena").groupBy("antena").keys().value(),e.selectedFrecuencias=[],e.frecuencias=t(s).map(function(e){return e.frecuencias}).flattenDeep().uniq().value(),e.selectedRedes=[],e.redes=t(s).map(function(e){return e.redes}).flattenDeep().uniq().value(),e.selectedDisenos=[],e.disenos=t(s).sortBy("diseno").groupBy("diseno").keys().value(),e.selectedOtras=[],e.otras=t(s).sortBy("otras").groupBy("otras").keys().value()}).catch(function(e){}),e.getPrecio=function(e){return(e.precio/1e3).toFixed(2)},e.getIVA=function(t){return(e.getPrecio(t)*e.iva).toFixed(2)},e.getTotalPrice=function(t){return(e.getPrecio(t)*(e.iva+1)).toFixed(2)},e.getCellphoneImage=function(e){return"http://movistar.com.ve/comparador/uploads/"+e.imagen_peq},e.updateModel=function(t,n){e[t]=n,e.filterCellphones()},e.changeDestacados=function(t){e.destacadoChoices=t,e.filterCellphones()},e.filterCellphones=function(){var n=e.desdePrecio?e.desdePrecio:e.minPrecio,o=e.hastaPrecio?e.hastaPrecio:e.maxPrecio,s=e.desdePuntos?e.desdePuntos:e.minPuntos,c=e.hastaPuntos?e.hastaPuntos:e.maxPuntos;e.cellphonesFiltered=t.filter(e.cellphones,function(l){var a=parseInt(e.getPrecio(l))>=n,r=parseInt(e.getPrecio(l))<=o,i=parseInt(l.club_movistar)>=s,d=parseInt(l.club_movistar)<=c,u=!0,p=!0,h=!0,m=!0,f=!0,g=!0,P=!0,v=!0;return e.destacadoChoices>0&&(u=l.destacado),e.selectedMarcas.length>0&&(p=t.includes(e.selectedMarcas,l.marca)),e.selectedTecnologias.length>0&&(h=t.includes(e.selectedTecnologias,l.tecnologia)),e.selectedAntenas.length>0&&(m=t.includes(e.selectedAntenas,l.antena)),e.selectedFrecuencias.length>0&&(f=t.intersection(e.selectedFrecuencias,l.frecuencias).length>0),e.selectedRedes.length>0&&(g=t.intersection(e.selectedRedes,l.redes).length>0),e.selectedDisenos.length>0&&(P=t.includes(e.selectedDisenos,l.diseno)),e.selectedOtras.length>0&&(v=t.includes(e.selectedOtras,l.otras)),a&&r&&i&&d&&u&&p&&h&&m&&f&&g&&P&&v})},e.getSelectedIds=function(){var n="";return t.each(e.selectedCellphones,function(e){n+=e}),e.selectedCellphones.join(",")},e.toggleSelection=function(n,o){var s=e["selected"+t.upperFirst(n)+"s"],c=s.indexOf(o);c>-1?s.splice(c,1):"cellphone"===n&&4===e.selectedCellphones.length||s.push(o),"cellphone"!==n&&e.filterCellphones()},e.isSelected=function(n,o){return e["selected"+t.upperFirst(n)+"s"].indexOf(o)>-1},e.goAndCompare=function(){e.showComparador=!0,n.setSelected(e.selectedCellphones),e.cellphonesToCompare=n.selectedCellphones},e.closeComparador=function(){e.showComparador=!1}}]);